{% extends "layout.html" %}
{% block content %}
<div class="max-w-md mx-auto bg-gray-800 p-8 rounded-lg">
    
    <h2 class="text-2xl font-bold text-white mb-6">Account Login</h2>
    {% if creds.token %}
        <div class="bg-green-900/30 border border-green-600 p-4 rounded mb-8">
            <p class="text-green-400 mb-4">Logged in as User ID: {{ creds.user_id }}</p>
            
            <!-- Unit Settings -->
            <form action="/settings/unit" method="POST" class="mb-4">
                <label class="block text-sm font-bold mb-2 text-gray-300">Unit System</label>
                <div class="flex gap-2">
                    <select name="unit" class="flex-grow p-2 bg-gray-700 rounded text-white border border-gray-600">
                        <option value="0" {% if creds.unit == 0 %}selected{% endif %}>Metric (KG)</option>
                        <option value="1" {% if creds.unit == 1 %}selected{% endif %}>Imperial (LBS)</option>
                    </select>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Save</button>
                </div>
            </form>

            <a href="/logout" class="block w-full text-center bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">Logout</a>
        </div>
    {% else %}
        <form action="/login" method="POST" class="mb-8 pb-8 border-b border-gray-700">
            <div class="mb-4">
                <label class="block text-sm font-bold mb-2 text-gray-300">Region</label>
                <select name="region" class="w-full p-2 bg-gray-700 rounded text-white border border-gray-600">
                    <option value="Global" {% if creds.region != 'EU' %}selected{% endif %}>Global (USA/Asia)</option>
                    <option value="EU" {% if creds.region == 'EU' %}selected{% endif %}>Europe</option>
                </select>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-bold mb-2 text-gray-300">Email</label>
                <input type="email" name="email" required class="w-full p-2 bg-gray-700 rounded text-white border border-gray-600">
            </div>
            <div class="mb-6">
                <label class="block text-sm font-bold mb-2 text-gray-300">Password</label>
                <input type="password" name="password" required class="w-full p-2 bg-gray-700 rounded text-white border border-gray-600">
            </div>
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Login</button>
        </form>
    {% endif %}

    <form action="/settings/device" method="POST" class="mb-8 pb-8 border-b border-gray-700">
        <label class="block text-sm font-bold mb-2 text-gray-300">Device Type</label>
        <div class="flex gap-2 mb-3">
            <select id="device_type" name="device_type" class="flex-grow p-2 bg-gray-700 rounded text-white border border-gray-600">
                <option value="1" {% if creds.device_type == 1 %}selected{% endif %}>Gym Monster</option>
                <option value="2" {% if creds.device_type == 2 %}selected{% endif %}>Gym Pal</option>
            </select>
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Save</button>
        </div>
        <div id="allow_monster_moves_wrap" class="flex items-center gap-2 text-sm text-gray-300">
            <input type="checkbox" id="allow_monster_moves" name="allow_monster_moves" class="h-4 w-4" {% if creds.allow_monster_moves %}checked{% endif %}>
            <label for="allow_monster_moves">Allow Gym Monster movements in Gym Pal workouts</label>
        </div>
        <p class="text-xs text-gray-500 mt-2">This only changes which exercises and workouts are fetched; it does not change your account login.</p>
    </form>

    <details class="mb-8 group">
        <summary class="text-xl font-bold text-white mb-4 cursor-pointer flex items-center select-none">
            <svg class="w-4 h-4 mr-2 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            Manual Config (Token/Region)
        </summary>
        <div class="pl-6 border-l-2 border-gray-700">
            <p class="text-sm text-gray-400 mb-4">
                These values are automatically filled when you log in above. You only need to change them manually if you are debugging or using a captured token.
            </p>
            <form method="POST">
                <div class="mb-4">
                    <label class="block text-sm font-bold mb-2 text-gray-300">Region</label>
                    <select name="region" class="w-full p-2 bg-gray-700 rounded text-white border border-gray-600">
                        <option value="Global" {% if creds.region != 'EU' %}selected{% endif %}>Global (USA/Asia)</option>
                        <option value="EU" {% if creds.region == 'EU' %}selected{% endif %}>Europe</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-bold mb-2 text-gray-300">App User ID</label>
                    <input type="text" name="user_id" value="{{ creds.user_id }}" class="w-full p-2 bg-gray-700 rounded text-white border border-gray-600 font-mono text-sm">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-bold mb-2 text-gray-300">Token (MD5)</label>
                    <input type="text" name="token" value="{{ creds.token }}" class="w-full p-2 bg-gray-700 rounded text-white border border-gray-600 font-mono text-sm">
                    <p class="text-xs text-gray-500 mt-2">You can find this in the header of a logged request (e.g. via PCAPdroid or Charles Proxy).</p>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-bold mb-2 text-gray-300">Unit (0=Metric, 1=Imperial)</label>
                    <input type="number" name="unit" value="{{ creds.unit }}" class="w-full p-2 bg-gray-700 rounded text-white border border-gray-600 font-mono text-sm">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-bold mb-2 text-gray-300">Device Type (1=Gym Monster, 2=Gym Pal)</label>
                    <input type="number" name="device_type" value="{{ creds.device_type }}" class="w-full p-2 bg-gray-700 rounded text-white border border-gray-600 font-mono text-sm">
                </div>
                <div class="mb-6 flex items-center gap-2 text-sm text-gray-300">
                    <input type="checkbox" id="allow_monster_moves_manual" name="allow_monster_moves" class="h-4 w-4" {% if creds.allow_monster_moves %}checked{% endif %}>
                    <label for="allow_monster_moves_manual">Allow Gym Monster movements in Gym Pal workouts</label>
                </div>
                <!-- Custom Instruction moved to Create Page Modal -->
                <input type="hidden" name="custom_instruction" value="{{ creds.custom_instruction }}">
                
                <button type="submit" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded border border-gray-600">Save Manual Config</button>
            </form>
        </div>
    </details>

    <details class="mt-8 pt-8 border-t border-gray-700 group">
        <summary class="text-xl font-bold text-white mb-4 cursor-pointer flex items-center select-none">
            <svg class="w-4 h-4 mr-2 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            Offline Content (Preload)
        </summary>
        <div class="pl-6 border-l-2 border-gray-700">
            <div class="bg-blue-900/30 border border-blue-600 p-4 rounded mb-4">
                <p class="text-blue-200 text-sm font-bold mb-2">ℹ️ Automatic Caching Active</p>
                <p class="text-gray-300 text-sm">
                    The app automatically caches images and videos as you browse the library. 
                    This ensures you only download what you view, saving bandwidth and avoiding unnecessary requests to Speediance servers.
                </p>
            </div>

            <div class="bg-red-900/30 border border-red-600 p-4 rounded mb-4">
                <p class="text-red-200 text-sm font-bold mb-2">⚠️ Warning: High Bandwidth Usage</p>
                <p class="text-gray-300 text-sm mb-2">
                    The "Download All Assets" button below will attempt to download the <strong>entire library (>100 GB)</strong> at once.
                </p>
                <p class="text-gray-300 text-sm">
                    <strong>Do not use this unless absolutely necessary.</strong> 
                    Downloading this amount of data in a short time may trigger security alerts and could lead to your <strong>account being blocked</strong> by Speediance.
                </p>
            </div>

            <a href="/settings/preload" target="_blank" class="block w-full text-center bg-gray-700 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-colors border border-gray-600">
                Download All Assets (Not Recommended)
            </a>
        </div>
    </details>

    <div class="mt-8 pt-8 border-t border-gray-700 text-center">
        <p class="text-xs text-gray-500">
            Disclaimer: This is an unofficial tool and is not affiliated with, endorsed by, or connected to Speediance. 
            Use at your own risk.
        </p>
    </div>
</div>
<script>
    const deviceSelect = document.getElementById('device_type');
    const allowWrap = document.getElementById('allow_monster_moves_wrap');
    if (deviceSelect && allowWrap) {
        const toggleAllow = () => {
            allowWrap.style.display = deviceSelect.value === '2' ? 'flex' : 'none';
        };
        deviceSelect.addEventListener('change', toggleAllow);
        toggleAllow();
    }
</script>
{% endblock %}
